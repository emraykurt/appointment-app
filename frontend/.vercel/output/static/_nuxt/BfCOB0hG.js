import{_ as y,n as x,w as b,T as k,o as i,c as l,p as m,a as s,q as h,t as d,s as v,b as D,u as S,v as _,d as C,F as p,x as f}from"./L7mNsP-l.js";const B={props:{isVisible:{type:Boolean,default:!1},title:{type:String,default:"Bilgi"},message:{type:String,default:""},type:{type:String,default:"info",validator:t=>["info","success","error","warning"].includes(t)},showCancelButton:{type:Boolean,default:!1},confirmButtonText:{type:String,default:"Tamam"},cancelButtonText:{type:String,default:"İptal"},closeOnBackdrop:{type:Boolean,default:!0}},computed:{headerClass(){switch(this.type){case"success":return"bg-green-50 border-green-200";case"error":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";default:return"bg-blue-50 border-blue-200"}},titleClass(){switch(this.type){case"success":return"text-green-800";case"error":return"text-red-800";case"warning":return"text-yellow-800";default:return"text-blue-800"}},confirmButtonClass(){switch(this.type){case"success":return"bg-green-600 hover:bg-green-700";case"error":return"bg-red-600 hover:bg-red-700";case"warning":return"bg-yellow-600 hover:bg-yellow-700";default:return"bg-blue-600 hover:bg-blue-700"}}}},T={key:0,class:"fixed inset-0 flex items-center justify-center z-50 overflow-hidden"},A={class:"bg-white rounded-lg shadow-xl overflow-hidden w-full max-w-md mx-4 z-10"},z={class:"px-6 py-4 max-h-[60vh] overflow-y-auto"},j={class:"text-gray-700"},R={class:"px-6 py-3 bg-gray-50 flex justify-end space-x-3"};function M(t,e,o,c,n,r){return i(),x(k,{name:"modal-fade"},{default:b(()=>[o.isVisible?(i(),l("div",T,[s("div",{class:"fixed inset-0 bg-black bg-opacity-50",onClick:e[0]||(e[0]=g=>o.closeOnBackdrop?t.$emit("close"):null)}),s("div",A,[s("div",{class:h(["px-6 py-4 border-b",r.headerClass])},[s("h3",{class:h(["text-lg font-medium",r.titleClass])},d(o.title),3)],2),s("div",z,[s("p",j,d(o.message),1),v(t.$slots,"default",{},void 0,!0)]),s("div",R,[o.showCancelButton?(i(),l("button",{key:0,onClick:e[1]||(e[1]=g=>t.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"},d(o.cancelButtonText),1)):m("",!0),s("button",{onClick:e[2]||(e[2]=g=>t.$emit("confirm")),class:h(["px-4 py-2 text-sm font-medium text-white rounded-md",r.confirmButtonClass])},d(o.confirmButtonText),3)])])])):m("",!0)]),_:3})}const w=y(B,[["render",M],["__scopeId","data-v-cbc479b9"]]),W={components:{Modal:w},data(){return{userData:{fullName:""},currentWeekStart:new Date,selectedSlot:{date:null,time:null},appointments:[],bookedSlots:[],isLoading:!1,isSubmitting:!1,isDeletingAppointment:null,timeSlots:[],userRole:"user",token:null,modal:{isVisible:!1,title:"",message:"",type:"info",showCancelButton:!1,confirmButtonText:"Tamam",cancelButtonText:"İptal",onConfirm:null},appointmentToCancel:null}},computed:{currentWeekDays(){const t=[],e=["Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi","Pazar"],o=new Date(this.currentWeekStart),c=o.getDay();c===0?o.setDate(o.getDate()-6):c>1&&o.setDate(o.getDate()-(c-1));for(let n=0;n<7;n++){const r=new Date(o);r.setDate(r.getDate()+n),t.push({date:this.formatDate(r),name:e[n],shortDate:`${r.getDate().toString().padStart(2,"0")}.${(r.getMonth()+1).toString().padStart(2,"0")}`})}return t},calendarDateRange(){if(this.currentWeekDays.length===0)return"";const t=this.currentWeekDays[0].shortDate,e=this.currentWeekDays[6].shortDate,o=new Date().getFullYear();return`${t}.${o} - ${e}-${o}`},formatSelectedDate(){if(!this.selectedSlot.date)return"";const t=this.selectedSlot.date.split("-");return`${t[2]}.${t[1]}.${t[0]}`},todayAppointments(){const t=this.formatDate(new Date);return this.appointments.filter(e=>e.date===t)}},mounted(){this.generateTimeSlots();const t=new Date;this.currentWeekStart=t,this.token=localStorage.getItem("token"),this.token&&(this.decodeUserRole(),this.fetchAppointments(),this.fetchBookedSlots())},previousWeek(){const t=new Date(this.currentWeekStart);t.setDate(t.getDate()-7);const e=new Date;if(e.setHours(0,0,0,0),this.getWeekStartDate(t)<e){this.showModal("Uyarı","Geçmiş tarihlere gidemezsiniz.","warning");return}this.currentWeekStart=t},getWeekStartDate(t){const e=new Date(t),o=e.getDay();return o===0?e.setDate(e.getDate()-6):o>1&&e.setDate(e.getDate()-(o-1)),e.setHours(0,0,0,0),e},methods:{showModal(t,e,o="info",c=!1,n=null){this.modal={isVisible:!0,title:t,message:e,type:o,showCancelButton:c,confirmButtonText:"Tamam",cancelButtonText:"İptal",onConfirm:n}},closeModal(){this.modal.isVisible=!1},formatDate(t){const e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${c}`},isPastDate(t){const e=new Date;e.setHours(0,0,0,0);const o=new Date(t);return o.setHours(0,0,0,0),o<e},isPastTime(t,e){const o=this.formatDate(new Date);if(t!==o)return!1;const c=new Date,[n,r]=e.split(":").map(Number);return n<c.getHours()||n===c.getHours()&&r<=c.getMinutes()},isSlotAvailable(t,e){return this.isPastDate(t)||this.isPastTime(t,e)?!1:!this.bookedSlots.some(o=>o.date===t&&o.time===e)},isSlotSelectable(t,e){return this.isPastDate(t)||this.isPastTime(t,e)?!1:this.isSlotAvailable(t,e)},getSlotStyle(t,e){return this.isPastDate(t)||this.isPastTime(t,e)?"bg-gray-200 cursor-not-allowed opacity-50":this.isSlotAvailable(t,e)?this.isSelectedSlot(t,e)?"bg-blue-100 hover:bg-blue-200":"bg-green-100 hover:bg-green-200":"bg-gray-100 cursor-not-allowed"},decodeUserRole(){try{const e=this.token.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(e).split("").map(function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join("")),c=JSON.parse(o);this.userRole=c.role||"user"}catch(t){console.error("Token decode edilemedi:",t),this.userRole="user"}},generateTimeSlots(){const t=[];for(let e=8;e<18;e++)t.push(`${e.toString().padStart(2,"0")}:00`),t.push(`${e.toString().padStart(2,"0")}:30`);this.timeSlots=t},formatDate(t){const e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${c}`},formatDateForDisplay(t){if(!t)return"";const e=t.split("-");return`${e[2]}.${e[1]}.${e[0]}`},isSlotAvailable(t,e){return!this.bookedSlots.some(o=>o.date===t&&o.time===e)},isSelectedSlot(t,e){return this.selectedSlot.date===t&&this.selectedSlot.time===e},selectAppointment(t,e){this.selectedSlot={date:t,time:e}},previousWeek(){const t=new Date(this.currentWeekStart);t.setDate(t.getDate()-7),this.currentWeekStart=t},nextWeek(){const t=new Date(this.currentWeekStart);t.setDate(t.getDate()+7),this.currentWeekStart=t},async fetchAppointments(){this.isLoading=!0;try{if(this.token=localStorage.getItem("token"),!this.token)throw new Error("Giriş yapmalısınız");const t=await fetch("http://localhost:3001/api/appointments",{method:"GET",headers:{Authorization:this.token,"Content-Type":"application/json"}});if(!t.ok){const o=await t.json();throw new Error(o.error||"Randevular alınamadı")}const e=await t.json();this.appointments=e}catch(t){console.error("Randevular alınırken hata oluştu:",t),this.showModal("Hata",t.message,"error")}finally{this.isLoading=!1}},async fetchBookedSlots(){try{if(this.token=localStorage.getItem("token"),!this.token)throw new Error("Giriş yapmalısınız");const t=await fetch("http://localhost:3001/api/available-slots",{method:"GET",headers:{Authorization:this.token,"Content-Type":"application/json"}});if(!t.ok){const o=await t.json();throw new Error(o.error||"Randevu durumları alınamadı")}const e=await t.json();this.bookedSlots=e}catch(t){console.error("Randevu durumları alınırken hata oluştu:",t)}},async confirmAppointment(){if(!this.userData.fullName){this.showModal("Uyarı","Lütfen adınızı giriniz.","warning");return}if(!this.selectedSlot.date||!this.selectedSlot.time){this.showModal("Uyarı","Lütfen bir randevu tarihi ve saati seçiniz.","warning");return}this.isSubmitting=!0;try{if(this.token=localStorage.getItem("token"),!this.token)throw new Error("Giriş yapmalısınız");const t={name:this.userData.fullName,date:this.selectedSlot.date,time:this.selectedSlot.time},e=await fetch("http://localhost:3001/api/appointments",{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await e.json();if(!e.ok)throw new Error(o.error||"Randevu oluşturulamadı");await Promise.all([this.fetchAppointments(),this.fetchBookedSlots()]),this.selectedSlot={date:null,time:null},this.showModal("Başarılı","Randevunuz başarıyla oluşturuldu!","success")}catch(t){console.error("Randevu oluşturulurken hata oluştu:",t),this.showModal("Hata",t.message,"error")}finally{this.isSubmitting=!1}},promptCancelAppointment(t){this.appointmentToCancel=t,this.showModal("Randevu İptal","Bu randevuyu iptal etmek istediğinize emin misiniz?","warning",!0,()=>this.cancelAppointment(t))},async cancelAppointment(t){this.isDeletingAppointment=t;try{if(this.token=localStorage.getItem("token"),!this.token)throw new Error("Giriş yapmalısınız");const e=await fetch(`http://localhost:3001/api/appointments/${t}`,{method:"DELETE",headers:{Authorization:this.token,"Content-Type":"application/json"}});if(!e.ok){const o=await e.json();throw new Error(o.error||"Randevu iptal edilemedi")}await Promise.all([this.fetchAppointments(),this.fetchBookedSlots()]),this.showModal("Başarılı","Randevu başarıyla iptal edildi.","success")}catch(e){console.error("Randevu iptal edilirken hata oluştu:",e),this.showModal("Hata",e.message,"error")}finally{this.isDeletingAppointment=null,this.appointmentToCancel=null,this.closeModal()}}}},P={class:"min-h-screen bg-gray-50"},V={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pb-12"},N={class:"flex flex-col lg:flex-row gap-6"},E={class:"w-full lg:w-1/3 space-y-6"},H={class:"bg-white shadow rounded-lg p-6"},U={class:"space-y-4"},L={key:0,class:"bg-white shadow rounded-lg p-6"},F={class:"space-y-3"},G={class:"flex justify-between"},I={class:"font-medium"},O={class:"flex justify-between"},Y={class:"font-medium"},J={key:1,class:"bg-white shadow rounded-lg p-6"},q={class:"space-y-3 mb-6"},K={class:"flex justify-between"},Q={class:"font-medium"},X={class:"flex justify-between"},Z={class:"font-medium"},$=["disabled"],ee={key:0,class:"flex items-center"},te={key:1},se={key:2,class:"bg-white shadow rounded-lg p-6"},oe={class:"text-lg font-medium text-gray-900 mb-4"},ne={key:0,class:"py-4 text-center"},re={key:1,class:"divide-y divide-gray-200"},ae={class:"flex justify-between items-start"},ie={class:"font-medium text-gray-900"},le={class:"text-sm text-gray-500"},de=["onClick","disabled"],ce={key:0},ue={key:1},me={class:"w-full lg:w-2/3"},he={class:"bg-white shadow rounded-lg overflow-hidden"},ge={class:"flex justify-between items-center px-6 py-4 border-b border-gray-200"},pe={class:"text-xl font-semibold text-gray-800"},fe={class:"grid grid-cols-8 border-b border-gray-200"},ye={class:"h-12 flex flex-col justify-center"},we={class:"text-sm font-medium text-gray-900"},xe={class:"text-sm text-gray-500"},be={class:"divide-y divide-gray-200"},ke={class:"border-r border-gray-200 py-3 px-2 text-center text-sm text-gray-500 flex items-center justify-center"},ve=["onClick"],De={key:1,class:"w-full h-full py-3 px-2 bg-gray-100 flex items-center justify-center"},Se={class:"text-sm font-medium text-gray-400 text-center line-through"},_e={key:2,class:"w-full h-full py-3 px-2 bg-gray-200 opacity-50 flex items-center justify-center"},Ce={class:"text-sm font-medium text-gray-500 text-center line-through"};function Be(t,e,o,c,n,r){const g=w;return i(),l("div",P,[s("main",V,[s("div",N,[s("div",E,[s("div",H,[e[6]||(e[6]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Kişisel Bilgiler",-1)),s("div",U,[s("div",null,[e[5]||(e[5]=s("label",{for:"fullName",class:"block text-sm font-medium text-gray-700 mb-1"},"Ad Soyad",-1)),S(s("input",{id:"fullName","onUpdate:modelValue":e[0]||(e[0]=a=>n.userData.fullName=a),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Adınız Soyadınız"},null,512),[[_,n.userData.fullName]])])])]),n.userRole==="admin"?(i(),l("div",L,[e[9]||(e[9]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Admin Paneli",-1)),s("div",F,[s("div",G,[e[7]||(e[7]=s("p",{class:"text-sm text-gray-500"},"Toplam Randevu:",-1)),s("p",I,d(n.appointments.length),1)]),s("div",O,[e[8]||(e[8]=s("p",{class:"text-sm text-gray-500"},"Bugünkü Randevular:",-1)),s("p",Y,d(r.todayAppointments.length),1)])])])):m("",!0),n.selectedSlot.date&&n.selectedSlot.time?(i(),l("div",J,[e[13]||(e[13]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Randevu Bilgileri",-1)),s("div",q,[s("div",K,[e[10]||(e[10]=s("p",{class:"text-sm text-gray-500"},"Tarih:",-1)),s("p",Q,d(r.formatSelectedDate),1)]),s("div",X,[e[11]||(e[11]=s("p",{class:"text-sm text-gray-500"},"Saat:",-1)),s("p",Z,d(n.selectedSlot.time),1)])]),s("button",{onClick:e[1]||(e[1]=(...a)=>r.confirmAppointment&&r.confirmAppointment(...a)),class:"w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:n.isSubmitting},[n.isSubmitting?(i(),l("span",ee,e[12]||(e[12]=[s("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),C(" İşleniyor... ")]))):(i(),l("span",te,"Randevuyu Onayla"))],8,$)])):m("",!0),n.appointments.length>0?(i(),l("div",se,[s("h2",oe,d(n.userRole==="admin"?"Tüm Randevular":"Randevularınız"),1),n.isLoading?(i(),l("div",ne,e[14]||(e[14]=[s("svg",{class:"animate-spin h-6 w-6 text-blue-600 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):(i(),l("div",re,[(i(!0),l(p,null,f(n.appointments,a=>(i(),l("div",{key:a._id,class:"py-3"},[s("div",ae,[s("div",null,[s("p",ie,d(a.name),1),s("p",le,d(r.formatDateForDisplay(a.date))+" - "+d(a.time),1)]),s("button",{onClick:u=>r.promptCancelAppointment(a._id),class:"text-red-600 hover:text-red-900 text-sm",disabled:n.isDeletingAppointment===a._id},[n.isDeletingAppointment===a._id?(i(),l("span",ce,e[15]||(e[15]=[s("svg",{class:"animate-spin inline-block h-4 w-4 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):(i(),l("span",ue,"İptal"))],8,de)])]))),128))]))])):m("",!0)]),s("div",me,[s("div",he,[s("div",ge,[s("button",{onClick:e[2]||(e[2]=(...a)=>r.previousWeek&&r.previousWeek(...a)),class:"p-2 rounded-full hover:bg-gray-100"},e[16]||(e[16]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),s("h2",pe,d(r.calendarDateRange),1),s("button",{onClick:e[3]||(e[3]=(...a)=>r.nextWeek&&r.nextWeek(...a)),class:"p-2 rounded-full hover:bg-gray-100"},e[17]||(e[17]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))]),s("div",fe,[e[18]||(e[18]=s("div",{class:"border-r border-gray-200"},[s("div",{class:"h-12 flex items-center justify-center font-medium text-gray-500"},"Saat")],-1)),(i(!0),l(p,null,f(r.currentWeekDays,a=>(i(),l("div",{key:a.date,class:"text-center"},[s("div",ye,[s("span",we,d(a.name),1),s("span",xe,d(a.shortDate),1)])]))),128))]),s("div",be,[(i(!0),l(p,null,f(n.timeSlots,a=>(i(),l("div",{key:a,class:"grid grid-cols-8"},[s("div",ke,d(a),1),(i(!0),l(p,null,f(r.currentWeekDays,u=>(i(),l("div",{key:`${u.date}-${a}`,class:"relative"},[r.isSlotSelectable(u.date,a)?(i(),l("button",{key:0,onClick:Te=>r.selectAppointment(u.date,a),class:h(["w-full h-full py-3 px-2",r.getSlotStyle(u.date,a)])},[s("span",{class:h(["inline-block w-full text-sm font-medium",r.isSelectedSlot(u.date,a)?"text-blue-800":"text-green-800"])},d(a),3)],10,ve)):r.isPastDate(u.date)||r.isPastTime(u.date,a)?(i(),l("div",De,[s("span",Se,d(a),1)])):(i(),l("div",_e,[s("span",Ce,d(a),1)]))]))),128))]))),128))])])])])]),D(g,{isVisible:n.modal.isVisible,title:n.modal.title,message:n.modal.message,type:n.modal.type,showCancelButton:n.modal.showCancelButton,confirmButtonText:n.modal.confirmButtonText,cancelButtonText:n.modal.cancelButtonText,onClose:r.closeModal,onConfirm:e[4]||(e[4]=a=>n.modal.onConfirm?n.modal.onConfirm():r.closeModal())},null,8,["isVisible","title","message","type","showCancelButton","confirmButtonText","cancelButtonText","onClose"])])}const ze=y(W,[["render",Be]]);export{ze as default};
